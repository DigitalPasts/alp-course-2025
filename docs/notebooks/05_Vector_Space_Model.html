<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ancient Language Processing / Gordin, Lincke, and Mara – vector_space_model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Alef:wght@400;700&amp;display=swap" rel="stylesheet">


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../digpasts_logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Ancient Language Processing / Gordin, Lincke, and Mara</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">Course Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../coursework.html">
 <span class="menu-text">Coursework</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-code-notebooks" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Code Notebooks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-code-notebooks">    
        <li>
    <a class="dropdown-item" href="../notebooks/index.html">
 <span class="dropdown-text">Notebooks</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/01_colab_intro.html">
 <span class="dropdown-text">Colab Intro</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../notebooks/02_Python_Brush_up.html">
 <span class="dropdown-text">Python Brush up</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../resources.html">
 <span class="menu-text">Materials and Texts</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro" id="toc-intro" class="nav-link active" data-scroll-target="#intro">Intro</a></li>
  <li><a href="#preprocessing-the-corpus" id="toc-preprocessing-the-corpus" class="nav-link" data-scroll-target="#preprocessing-the-corpus">Preprocessing the corpus</a>
  <ul class="collapse">
  <li><a href="#imports" id="toc-imports" class="nav-link" data-scroll-target="#imports">Imports</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a>
  <ul class="collapse">
  <li><a href="#to-upload-corpus-and-metadata-from-github" id="toc-to-upload-corpus-and-metadata-from-github" class="nav-link" data-scroll-target="#to-upload-corpus-and-metadata-from-github">To upload corpus and metadata from GitHub</a></li>
  <li><a href="#to-convert-dataframe-to-string" id="toc-to-convert-dataframe-to-string" class="nav-link" data-scroll-target="#to-convert-dataframe-to-string">To convert dataframe to string</a></li>
  <li><a href="#to-convert-to-specific-word-levels-and-create-dictionaries" id="toc-to-convert-to-specific-word-levels-and-create-dictionaries" class="nav-link" data-scroll-target="#to-convert-to-specific-word-levels-and-create-dictionaries">To convert to specific word levels and create dictionaries</a></li>
  <li><a href="#to-create-the-vector-space-model" id="toc-to-create-the-vector-space-model" class="nav-link" data-scroll-target="#to-create-the-vector-space-model">To create the vector space model</a></li>
  </ul></li>
  <li><a href="#process-texts-from-dataframes-and-combine-results-with-metadata-dataframe" id="toc-process-texts-from-dataframes-and-combine-results-with-metadata-dataframe" class="nav-link" data-scroll-target="#process-texts-from-dataframes-and-combine-results-with-metadata-dataframe">Process texts from dataframes and combine results with metadata dataframe</a></li>
  </ul></li>
  <li><a href="#exploring-the-akkadian-rinap-or-egyptian-tla-corpus-using-the-vector-space-model" id="toc-exploring-the-akkadian-rinap-or-egyptian-tla-corpus-using-the-vector-space-model" class="nav-link" data-scroll-target="#exploring-the-akkadian-rinap-or-egyptian-tla-corpus-using-the-vector-space-model">Exploring the Akkadian RINAP or Egyptian TLA Corpus using the Vector Space Model</a></li>
  <li><a href="#find-shared-tokens" id="toc-find-shared-tokens" class="nav-link" data-scroll-target="#find-shared-tokens">Find Shared Tokens</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="intro" class="level1">
<h1>Intro</h1>
<p>In this notebook, we explore a collection of ancient Akkadian and ancient Egyptian texts using the vector space model approach described by <a href="https://www.humanitiesdataanalysis.org/vector-space-model/notebook.html">Karsdorp et al.&nbsp;in the chapter “Exploring Texts using the Vector Space Model”</a>. By representing the texts as numeric vectors capturing word frequencies, we can quantify the lexical similarities and differences between corpora in each of these two ancient languages. The vector space model allows us to reason about texts spatially and apply geometric concepts like distance metrics to assess how “close” texts are to each other based on shared vocabulary.</p>
<p>We preprocess the texts by tokenizing them into words, constructing a document-term matrix recording word frequencies per text, and analyzing the matrix using tools from the Python scientific computing stack, including NumPy, SciPy and Scikit-learn. Through techniques like tSNE (t-Distributed Stochastic Neighbor Embedding) and aggregation by text metadata like script type, language or genre, we explore patterns in the Akkadian and Egyptian corpora and showcase how the vector space model can yield quantitative insights into ancient textual data. The notebook serves as an example application of the concepts and methods covered in depth by Karsdorp et al.&nbsp;in their chapter.</p>
<p>This notebook has been prepared by <strong>Avital Romach</strong> and is based on her research. It should be cited accordingly (see citation information at the bottom).</p>
</section>
<section id="preprocessing-the-corpus" class="level1">
<h1>Preprocessing the corpus</h1>
<section id="imports" class="level2">
<h2 class="anchored" data-anchor-id="imports">Imports</h2>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385519760,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:11229,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> CountVectorizer, TfidfVectorizer</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.spatial.distance <span class="im">import</span> pdist, squareform</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.manifold <span class="im">import</span> TSNE</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="functions" class="level2">
<h2 class="anchored" data-anchor-id="functions">Functions</h2>
<section id="to-upload-corpus-and-metadata-from-github" class="level3">
<h3 class="anchored" data-anchor-id="to-upload-corpus-and-metadata-from-github">To upload corpus and metadata from GitHub</h3>
<section id="functions-and-import-for-the-akkadian-corpus" class="level4">
<h4 class="anchored" data-anchor-id="functions-and-import-for-the-akkadian-corpus">Functions and import for the <strong>Akkadian</strong> corpus</h4>
<p>The Akkadian corpus consists of a part of the <em><a href="https://colab.research.google.com/drive/14hTZCg-9XyiireusajDQqc9k2GAbc82e#scrollTo=qUcbzacX0kJy&amp;line=3&amp;uniqifier=1">Royal Inscriptions of the Neo-Assyrian Period (RINAP)</a></em>, licensed CC-BY-SA, and was taken from Open Richely Annotated Cuneiform Corpus (ORACC).</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385633433,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:238,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_corpus_from_github_api(url):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># URL on the Github where the csv files are stored</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  github_url <span class="op">=</span> url</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  response <span class="op">=</span> requests.get(github_url)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  corpus <span class="op">=</span> []</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the request was successful</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    files <span class="op">=</span> response.json()</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> <span class="bu">file</span>[<span class="st">"download_url"</span>][<span class="op">-</span><span class="dv">3</span>:] <span class="op">==</span> <span class="st">"csv"</span>:</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        corpus.append(pd.read_csv(<span class="bu">file</span>[<span class="st">"download_url"</span>], encoding<span class="op">=</span><span class="st">"utf-8"</span>, index_col<span class="op">=</span><span class="st">"Unnamed: 0"</span>).fillna(<span class="st">""</span>))</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For Egyptian adapt like this:</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">#corpus.append(pd.read_csv(file["download_url"], encoding="utf-8").fillna(""))</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Failed to retrieve files:'</span>, response.status_code)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> corpus</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_metadata_from_raw_github(url):</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  metadata <span class="op">=</span> pd.read_csv(url, encoding<span class="op">=</span><span class="st">"utf-8"</span>, index_col<span class="op">=</span><span class="st">"Unnamed: 0"</span>).fillna(<span class="st">""</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385790185,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:122495,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Akkadian corpus (list of dataframes)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>corpus <span class="op">=</span> create_corpus_from_github_api(<span class="st">'https://api.github.com/repos/DigitalPasts/ALP-course/contents/course_notebooks/data/rinap01'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>corpus.extend(create_corpus_from_github_api(<span class="st">'https://api.github.com/repos/DigitalPasts/ALP-course/contents/course_notebooks/data/rinap05'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385803244,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:723,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Akkadian metadata</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> get_metadata_from_raw_github(<span class="st">"https://raw.githubusercontent.com/DigitalPasts/ALP-course/master/course_notebooks/data/rinap1_5_metadata.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="functions-and-import-for-the-egyptian-corpus" class="level4">
<h4 class="anchored" data-anchor-id="functions-and-import-for-the-egyptian-corpus">Functions and import for the <strong>Egyptian</strong> corpus</h4>
<p>The Egyptian corpus is an extract of the database of the <em><a href="https://thesaurus-linguae-aegyptiae.de">Thesaurus Linguae Aegyptiae (TLA)</a></em>, containing literary (and if you like: medical) texts. This export from the database is not published under a free license. Therefore, we access it from a private GitHub repository using an access token.</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385519760,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:2,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_corpus_from_private_github_api(url, token):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># URL on the Github where the csv files are stored</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Authorization"</span>: <span class="ss">f"token </span><span class="sc">{</span>token<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    github_url <span class="op">=</span> url</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(github_url, headers<span class="op">=</span>headers)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    dtype_dict <span class="op">=</span> {<span class="st">"lemma_id"</span>: <span class="st">"str"</span>}</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    corpus <span class="op">=</span> []</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the request was successful</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        files <span class="op">=</span> response.json()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">file</span>[<span class="st">"download_url"</span>][<span class="op">-</span><span class="dv">3</span>:] <span class="op">==</span> <span class="st">"csv"</span> <span class="kw">or</span> <span class="st">".csv?token="</span> <span class="kw">in</span> <span class="bu">file</span>[<span class="st">"download_url"</span>]:</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                corpus.append(pd.read_csv(<span class="bu">file</span>[<span class="st">"download_url"</span>], encoding<span class="op">=</span><span class="st">"utf-8"</span>, sep <span class="op">=</span> <span class="st">','</span>, dtype<span class="op">=</span>dtype_dict).fillna(<span class="st">""</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'Failed to retrieve files:'</span>, response.status_code)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> corpus</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_metadata_from_raw_private_github(url, token):</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    headers <span class="op">=</span> {</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Authorization"</span>: <span class="ss">f"token </span><span class="sc">{</span>token<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    github_url <span class="op">=</span> url</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(github_url, headers<span class="op">=</span>headers)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the request was successful</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        csv_data <span class="op">=</span> StringIO(response.text)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        metadata <span class="op">=</span> pd.read_csv(csv_data, encoding<span class="op">=</span><span class="st">"utf-8"</span>, sep <span class="op">=</span> <span class="st">','</span>, index_col<span class="op">=</span><span class="st">"text_id"</span>).fillna(<span class="st">""</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> metadata</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="ss">f"Failed to retrieve metadata: </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385520262,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:504,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="d29f230d-0cd6-458b-cb15-4c0d29b87aee" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># only if corpus is not yet loaded</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Egyptian corpus (list sof dataframes)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">False</span>:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#tla_access_token = "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"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  tla_access_token <span class="op">=</span> <span class="st">"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"</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">## TLA Literature</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  corpus <span class="op">=</span> create_corpus_from_private_github_api(<span class="st">'https://api.github.com/repos/thesaurus-linguae-aegyptiae/test-rawdata/contents/alp-course-2024/TLA_literature/erzaehlungen'</span>, tla_access_token)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  corpus.extend(create_corpus_from_private_github_api(<span class="st">'https://api.github.com/repos/thesaurus-linguae-aegyptiae/test-rawdata/contents/alp-course-2024/TLA_literature/reden'</span>, tla_access_token))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  corpus.extend(create_corpus_from_private_github_api(<span class="st">'https://api.github.com/repos/thesaurus-linguae-aegyptiae/test-rawdata/contents/alp-course-2024/TLA_literature/lehren'</span>, tla_access_token))</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">## TLA Medical</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#corpus = create_corpus_from_private_github_api('https://api.github.com/repos/thesaurus-linguae-aegyptiae/test-rawdata/contents/alp-course-2024/TLA_medical/TLA_pEbers', tla_access_token)</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#corpus.extend(create_corpus_from_private_github_api('https://api.github.com/repos/thesaurus-linguae-aegyptiae/test-rawdata/contents/alp-course-2024/TLA_medical/TLA_pEdwinSmith', tla_access_token))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Failed to retrieve files: 401
Failed to retrieve files: 401
Failed to retrieve files: 401</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;error&quot;,&quot;timestamp&quot;:1737385521414,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:1153,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="f9fa699d-50dd-42f5-f684-846242026cb5" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Egyptian metadata</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># metadata = get_metadata_from_raw_private_github("https://raw.githubusercontent.com/thesaurus-linguae-aegyptiae/test-rawdata/master/alp-course-2024/TLA_literature/TLA_metadata.csv", tla_access_token)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Exception: Failed to retrieve metadata: 404</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385860045,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:524,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="ba2bee97-bf42-4bae-fb06-e3f042033eb7" data-execution_count="12">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>corpus[<span class="dv">0</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">


  <div id="df-be683b59-193d-42dd-92c6-93f4cc78eda9" class="colab-df-container">
    <div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>ref</th>
      <th>inst</th>
      <th>frag</th>
      <th>norm</th>
      <th>cf</th>
      <th>sense</th>
      <th>pos</th>
      <th>unicode</th>
      <th>unicode_word</th>
      <th>reading</th>
      <th>break</th>
      <th>break_perc</th>
      <th>mask</th>
      <th>lang</th>
      <th>text</th>
      <th>line</th>
      <th>word</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9515</th>
      <td>Q003414.2.1</td>
      <td>perʾu[bud//offspring]N$perʾi</td>
      <td>NUNUZ</td>
      <td>perʾi</td>
      <td>perʾu</td>
      <td>offspring</td>
      <td>N</td>
      <td>['𒉭']</td>
      <td>𒉭</td>
      <td>NUNUZ</td>
      <td>['complete']</td>
      <td>0.00</td>
      <td></td>
      <td></td>
      <td>Q003414</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9516</th>
      <td>Q003414.2.2</td>
      <td>Baltil[Aššur]QN</td>
      <td>bal-til{ki}</td>
      <td>Baltil</td>
      <td>Baltil</td>
      <td>Aššur</td>
      <td>QN</td>
      <td>['𒁄', '𒌀', '𒆠']</td>
      <td>𒁄𒌀𒆠</td>
      <td>bal-til{KI}</td>
      <td>['complete', 'complete', 'complete']</td>
      <td>0.00</td>
      <td></td>
      <td></td>
      <td>Q003414</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9517</th>
      <td>Q003414.2.3</td>
      <td>šūquru[very valuable]AJ</td>
      <td>šu-⸢qu-ru⸣</td>
      <td>šūquru</td>
      <td>šūquru</td>
      <td>very valuable</td>
      <td>AJ</td>
      <td>['𒋗', '𒄣', '𒊒']</td>
      <td>𒋗𒄣𒊒</td>
      <td>šu-⸢qu-ru⸣</td>
      <td>['complete', 'damaged', 'damaged']</td>
      <td>0.33</td>
      <td></td>
      <td></td>
      <td>Q003414</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>9518</th>
      <td>Q003414.2.4</td>
      <td>narām[loved one]N</td>
      <td>na-ram</td>
      <td>narām</td>
      <td>narāmu</td>
      <td>loved one</td>
      <td>N</td>
      <td>['𒈾', '𒉘']</td>
      <td>𒈾𒉘</td>
      <td>na-ram</td>
      <td>['complete', 'complete']</td>
      <td>0.00</td>
      <td></td>
      <td></td>
      <td>Q003414</td>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>9519</th>
      <td>Q003414.2.5</td>
      <td>u</td>
      <td>{d}[(...)</td>
      <td></td>
      <td></td>
      <td></td>
      <td>u</td>
      <td>['𒀭', 'x']</td>
      <td>𒀭x</td>
      <td>{d}[x]</td>
      <td>['complete', 'missing']</td>
      <td>0.50</td>
      <td></td>
      <td></td>
      <td>Q003414</td>
      <td>2</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-be683b59-193d-42dd-92c6-93f4cc78eda9')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-be683b59-193d-42dd-92c6-93f4cc78eda9 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-be683b59-193d-42dd-92c6-93f4cc78eda9');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-6c982fde-71a0-4f0b-912d-fdda6caa2328">
  <button class="colab-df-quickchart" onclick="quickchart('df-6c982fde-71a0-4f0b-912d-fdda6caa2328')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-6c982fde-71a0-4f0b-912d-fdda6caa2328 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

    </div>
  </div>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385864555,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:241,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="3986a404-4028-4574-a6bf-a5628050262a" data-execution_count="13">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare text_ids (list of unique ids), and metadata</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>text_ids <span class="op">=</span> []</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> text <span class="kw">in</span> corpus:</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  text_ids.append(text[<span class="st">"text"</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">id</span> <span class="kw">in</span> text_ids:</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">id</span> <span class="kw">not</span> <span class="kw">in</span> metadata.index:</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Text </span><span class="sc">{</span><span class="bu">id</span><span class="sc">}</span><span class="ss"> missing from metadata"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>metadata <span class="op">=</span> metadata[metadata.index.isin(text_ids)]</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">


  <div id="df-66ca47d0-0b62-4b44-aa1a-3e945326e2f1" class="colab-df-container">
    <div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>langs</th>
      <th>project</th>
      <th>cdli_id</th>
      <th>collection</th>
      <th>credits</th>
      <th>date_of_origin</th>
      <th>designation</th>
      <th>display_name</th>
      <th>dynastic_seat</th>
      <th>exemplars</th>
      <th>...</th>
      <th>ruler</th>
      <th>script</th>
      <th>script_remarks</th>
      <th>script_type</th>
      <th>subgenre</th>
      <th>supergenre</th>
      <th>trans</th>
      <th>id_text</th>
      <th>seal_id</th>
      <th>attribution</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Q003414</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463047</td>
      <td>Archäologisches Institut der Universität Züric...</td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 01</td>
      <td>RINAP 1 Tigl. III 01</td>
      <td>Assyria</td>
      <td>ZhArchSlg 1917 (+) ZhArchSlg 1918 (+) NA 12/76</td>
      <td>...</td>
      <td>Tiglath-pileser III</td>
      <td>Neo-Assyrian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>Q003415</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463047</td>
      <td></td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 02</td>
      <td>RINAP 1 Tigl. III 02</td>
      <td>Assyria</td>
      <td>NA 12/76</td>
      <td>...</td>
      <td>Tiglath-pileser III</td>
      <td>Neo-Assyrian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>Q003416</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463048</td>
      <td></td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 03</td>
      <td>RINAP 1 Tigl. III 03</td>
      <td>Assyria</td>
      <td>NA 09/76</td>
      <td>...</td>
      <td>Tiglath-pileser III</td>
      <td>Neo-Assyrian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>Q003417</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463048</td>
      <td></td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 04</td>
      <td>RINAP 1 Tigl. III 04</td>
      <td>Assyria</td>
      <td>NA 09/76</td>
      <td>...</td>
      <td>Tiglath-pileser III</td>
      <td>Neo-Assyrian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>Q003418</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463049</td>
      <td>British Museum, London, UK</td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 05</td>
      <td>RINAP 1 Tigl. III 05</td>
      <td>Assyria</td>
      <td>BM 118934 (Layard, MS A pp. 113-114)</td>
      <td>...</td>
      <td>Tiglath-pileser III</td>
      <td>Neo-Assyrian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Q009295</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td>British Museum, London, UK</td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>668-ca. 631</td>
      <td>Ashurbanipal 1027</td>
      <td>RINAP 5 Asb. 1027</td>
      <td>Assyria</td>
      <td>K 06681</td>
      <td>...</td>
      <td>Ashurbanipal</td>
      <td>Neo-Assyrian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Ashurbanipal</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
    </tr>
    <tr>
      <th>Q009296</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td>British Museum, London, UK</td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>668-ca. 631</td>
      <td>Ashurbanipal 1028</td>
      <td>RINAP 5 Asb. 1028</td>
      <td>Assyria</td>
      <td>K 06806</td>
      <td>...</td>
      <td>Ashurbanipal</td>
      <td>Neo-Assyrian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Ashurbanipal</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
    </tr>
    <tr>
      <th>Q009297</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td>British Museum, London, UK</td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>668-ca. 631</td>
      <td>Ashurbanipal 1029</td>
      <td>RINAP 5 Asb. 1029</td>
      <td>Assyria</td>
      <td>Bu 1891-05-09, 0204</td>
      <td>...</td>
      <td>Ashurbanipal</td>
      <td>Neo-Assyrian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Ashurbanipal</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
    </tr>
    <tr>
      <th>Q009298</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>668-ca. 631</td>
      <td>Ashurbanipal 1030</td>
      <td>RINAP 5 Asb. 1030</td>
      <td>Assyria</td>
      <td>Shikaft-i Gulgul rock relief</td>
      <td>...</td>
      <td>Ashurbanipal</td>
      <td>Neo-Assyrian, Neo-Babylonian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Ashurbanipal</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
    </tr>
    <tr>
      <th>Q009503</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td>British Museum, London, UK</td>
      <td>Created by Jamie Novotny, 2022. Lemmatized by ...</td>
      <td>ca. 626-612</td>
      <td>Sîn-šarru-iškun 2001</td>
      <td>RINAP 5 Ssi 2001</td>
      <td>Assyria</td>
      <td>1855-12-05, 0252</td>
      <td>...</td>
      <td>Sîn-šarru-iškun</td>
      <td>Neo-Assyrian</td>
      <td>inscribed</td>
      <td>Cuneiform</td>
      <td>Sîn-šarru-iškun</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny, 2022. Lemmatized by ...</td>
    </tr>
  </tbody>
</table>
<p>432 rows × 31 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-66ca47d0-0b62-4b44-aa1a-3e945326e2f1')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-66ca47d0-0b62-4b44-aa1a-3e945326e2f1 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-66ca47d0-0b62-4b44-aa1a-3e945326e2f1');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-43130423-04a1-42f3-8ff9-336fd785c6f5">
  <button class="colab-df-quickchart" onclick="quickchart('df-43130423-04a1-42f3-8ff9-336fd785c6f5')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-43130423-04a1-42f3-8ff9-336fd785c6f5 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_33537c72-91df-4deb-aada-298ccb6af594">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('metadata')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_33537c72-91df-4deb-aada-298ccb6af594 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('metadata');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div>
</section>
</section>
<section id="to-convert-dataframe-to-string" class="level3">
<h3 class="anchored" data-anchor-id="to-convert-dataframe-to-string">To convert dataframe to string</h3>
<p><strong>Function to split the text dataframes according to a column</strong>. Used to separate text to lines: * param df: dataframe containing one word in each row. * param column: the column by which to split the dfs, perferably <code>text</code> or <code>line</code>. * return: a list of dataframes split according to the value given to the column parameter.</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385870170,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:203,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_df_by_column_value(df, column):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    dfs <span class="op">=</span> []</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    column_values <span class="op">=</span> df[column].unique()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> value <span class="kw">in</span> column_values:</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        split_df <span class="op">=</span> df[df[column]<span class="op">==</span>value]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        dfs.append(split_df)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dfs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385872988,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:244,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="4941d099-ad46-4e53-f144-1f4362b3728a" data-execution_count="15">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>split_df_by_column_value(corpus[<span class="dv">0</span>].head(), <span class="st">"line"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>[              ref                          inst         frag    norm      cf  \
 9515  Q003414.2.1  perʾu[bud//offspring]N$perʾi        NUNUZ   perʾi   perʾu   
 9516  Q003414.2.2               Baltil[Aššur]QN  bal-til{ki}  Baltil  Baltil   
 9517  Q003414.2.3       šūquru[very valuable]AJ   šu-⸢qu-ru⸣  šūquru  šūquru   
 9518  Q003414.2.4             narām[loved one]N       na-ram   narām  narāmu   
 9519  Q003414.2.5                             u    {d}[(...)                   
 
               sense pos          unicode unicode_word      reading  \
 9515      offspring   N            ['𒉭']            𒉭        NUNUZ   
 9516          Aššur  QN  ['𒁄', '𒌀', '𒆠']          𒁄𒌀𒆠  bal-til{KI}   
 9517  very valuable  AJ  ['𒋗', '𒄣', '𒊒']          𒋗𒄣𒊒   šu-⸢qu-ru⸣   
 9518      loved one   N       ['𒈾', '𒉘']           𒈾𒉘       na-ram   
 9519                  u       ['𒀭', 'x']           𒀭x       {d}[x]   
 
                                      break  break_perc mask lang     text  \
 9515                          ['complete']        0.00            Q003414   
 9516  ['complete', 'complete', 'complete']        0.00            Q003414   
 9517    ['complete', 'damaged', 'damaged']        0.33            Q003414   
 9518              ['complete', 'complete']        0.00            Q003414   
 9519               ['complete', 'missing']        0.50            Q003414   
 
       line  word  
 9515     2     1  
 9516     2     2  
 9517     2     3  
 9518     2     4  
 9519     2     5  ]</code></pre>
</div>
</div>
<p><strong>Function to convert the values from the text dataframe to a string of text with or without line breaks and word segmentation</strong>. * param df: the text dataframe * param column: the chosen column from the dataframe to construct the text from (preferably unicode_word, cf, or lemma) * param break_perc: a parameter which dictates whether to include broken words depending on the percentage of how broken they are. Compares this value to the <code>break_perc</code> column in the dataframe. Parameter is set to 1 (i.e.&nbsp;all words, whether broken or not, are included); can be any float between 0 and 1. * param mask: boolean whether to mask named entities or not; set to True. * return: a string which includes all the words in the texts according to the column chosen. Extra spaces that were between broken words or empty lines are removed.</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385878197,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:217,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> df2str(df, column, break_perc<span class="op">=</span><span class="dv">1</span>, mask<span class="op">=</span><span class="va">True</span>, segmentation<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check if column exists in dataframe. If not, return empty text.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> column <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="st">""</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># remove rows that include duplicate values for compound words</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> column <span class="kw">not</span> <span class="kw">in</span> [<span class="st">"norm"</span>, <span class="st">"cf"</span>, <span class="st">"sense"</span>, <span class="st">"pos"</span>]:</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> df.drop_duplicates(<span class="st">"ref"</span>).copy()</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if column entry is empty string, replace with UNK (can happen with normalization or lemmatization)</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        mask_empty <span class="op">=</span> df[column]<span class="op">==</span><span class="st">""</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        df[column] <span class="op">=</span> df[column].where(<span class="op">~</span>mask_empty, other<span class="op">=</span><span class="st">"UNK"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># mask proper nouns</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> mask <span class="kw">and</span> <span class="st">"pos"</span> <span class="kw">in</span> df.columns:</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>            mask_bool <span class="op">=</span> df[<span class="st">"pos"</span>].isin([<span class="st">"PN"</span>, <span class="st">"RN"</span>, <span class="st">"DN"</span>, <span class="st">"GN"</span>, <span class="st">"MN"</span>, <span class="st">"SN"</span>, <span class="st">"n"</span>])</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            df[column] <span class="op">=</span> df[column].where(<span class="op">~</span>mask_bool, other<span class="op">=</span>df[<span class="st">"pos"</span>])</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        <span class="co"># change number masking from `n` to `NUM`</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># !comment out for Egyptian</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if mask:</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">#    mask_num = df[column]=="n"</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">#    df[column] = df[column].where(~mask_num, other="NUM")</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        <span class="co"># remove rows without break_perc (happens with non-Akkadian words)</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">""</span> <span class="kw">in</span> df[<span class="st">"break_perc"</span>].unique():</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> df[df[<span class="st">"break_perc"</span>]<span class="op">!=</span><span class="st">""</span>].copy()</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># filter according to break_perc</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        mask_break <span class="op">=</span> df[<span class="st">"break_perc"</span>] <span class="op">&lt;=</span> break_perc</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        df[column] <span class="op">=</span> df[column].where(mask_break, other<span class="op">=</span><span class="st">"X"</span>)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate text length with and without UNK and x tokens</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        text_length_full <span class="op">=</span> df.shape[<span class="dv">0</span>]</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        mask_partial <span class="op">=</span> df[column].isin([<span class="st">"UNK"</span>, <span class="st">"X"</span>, <span class="st">"x"</span>])</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        text_length_partial <span class="op">=</span> text_length_full <span class="op">-</span> <span class="bu">sum</span>(mask_partial)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create text lines</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>        text <span class="op">=</span> <span class="st">""</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>        df_lines <span class="op">=</span> split_df_by_column_value(df, <span class="st">"line"</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> df_lines:</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>            word_list <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(<span class="va">None</span>, line[column].to_list()))</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> word_list <span class="op">!=</span> []:</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>                text <span class="op">+=</span> <span class="st">" "</span>.join(<span class="bu">map</span>(<span class="bu">str</span>, word_list)).replace(<span class="st">"x"</span>, <span class="st">"X"</span>).strip() <span class="op">+</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> segmentation <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># remove all white spaces (word segmentation and line breaks)</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>            text <span class="op">=</span> re.sub(<span class="vs">r"[\s\u00A0]+"</span>, <span class="st">""</span>, text)</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (text, text_length_full, text_length_partial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385882504,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:209,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="f902b177-eb42-4773-90c1-8c33f63998a3" data-execution_count="17">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df2str(corpus[<span class="dv">0</span>], <span class="st">"cf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>('perʾu Baltil šūquru narāmu UNK DN UNK UNK UNK UNK\npitqu DN ša ana bēlūtu mātu UNK UNK UNK UNK UNK UNK\nrabû ana šarrūtu šakkanakku UNK UNK UNK UNK UNK UNK\nmuṣṣibu šagigurrû ana UNK UNK UNK UNK UNK UNK UNK UNK šurīnu\nzikaru dannu nūru kiššatu nišu etellu UNK kalû malku UNK UNK UNK\ndāʾipu gērû eṭlu qardu sāpinu UNK nakru ša huršānu\netguru kīma qû salātu UNK UNK UNK UNK UNK UNK\n',
 75,
 39)</code></pre>
</div>
</div>
</section>
<section id="to-convert-to-specific-word-levels-and-create-dictionaries" class="level3">
<h3 class="anchored" data-anchor-id="to-convert-to-specific-word-levels-and-create-dictionaries">To convert to specific word levels and create dictionaries</h3>
<p><strong>Function to convert the dataframes into strings of lemmatized texts</strong>. * param corpus: a list of dataframes * param break_perc: a parameter which dictates whether to include broken words depending on the percentage of how broken they are. Compares this value to the <code>break_perc</code> column in the dataframe. Parameter is set to 1 (i.e.&nbsp;all words, whether broken or not, are included); can be any float between 0 and 1. * param mask: boolean whether to mask named entities or not; set to True. * return: a dictionary where the keys are the text IDs and the values are the lemmatized texts</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385891992,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:237,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_lemmatized_texts(corpus, break_perc<span class="op">=</span><span class="dv">1</span>, mask<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    texts_dict <span class="op">=</span> {}</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> df <span class="kw">in</span> corpus:</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get the text number from the dataframe "text" column</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> df[<span class="st">"text"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>        text, text_length_full, text_length_partial <span class="op">=</span> df2str(df, <span class="st">"lemma_id"</span>, break_perc, mask)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        texts_dict[key] <span class="op">=</span> (text, text_length_full, text_length_partial)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> texts_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385894401,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:227,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="e434dd03-2047-43a0-80f0-21724dc186a0" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>get_lemmatized_texts((split_df_by_column_value(corpus[<span class="dv">0</span>], <span class="st">"text"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>{'Q003414': ('', 0, 0)}</code></pre>
</div>
</div>
<p><strong>Function to convert the dataframes into strings of normalized texts</strong>. * param corpus: a list of dataframes * param break_perc: a parameter which dictates whether to include broken words depending on the percentage of how broken they are. Compares this value to the <code>break_perc</code> column in the dataframe. Parameter is set to 1 (i.e.&nbsp;all words, whether broken or not, are included); can be any float between 0 and 1. * param mask: boolean whether to mask named entities or not; set to True. * return: a dictionary where the keys are the text IDs and the values are the normalized texts</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385908202,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:389,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_normalized_texts(corpus, break_perc<span class="op">=</span><span class="dv">1</span>, mask<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    texts_dict <span class="op">=</span> {}</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> df <span class="kw">in</span> corpus:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get the text number from the dataframe "text" column</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> df[<span class="st">"text"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        text, text_length_full, text_length_partial <span class="op">=</span> df2str(df, <span class="st">"norm"</span>, break_perc, mask)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        texts_dict[key] <span class="op">=</span> (text, text_length_full, text_length_partial)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> texts_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385910671,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:240,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="91608813-d005-43df-93b7-14c0847e135a" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>get_normalized_texts((split_df_by_column_value(corpus[<span class="dv">0</span>], <span class="st">"text"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>{'Q003414': ('perʾi Baltil šūquru narām UNK DN UNK UNK UNK UNK\npitiq DN ša ana bēlūt mātāti UNK UNK UNK UNK UNK UNK\nirbû ana šarrūti šakkanakku UNK UNK UNK UNK UNK UNK\nmuṣṣib šagigurê ana UNK UNK UNK UNK UNK UNK UNK UNK šurinnī\nzikaru dannu nūr kiššat nišīšu etel UNK kal malkī UNK UNK UNK\ndāʾipu gārêšu eṭlu qardu sāpinu UNK nakiri ša hursānī\netgurūti kīma qê usallituma UNK UNK UNK UNK UNK UNK\n',
  75,
  39)}</code></pre>
</div>
</div>
<p><strong>Function to convert the dataframes into strings of segmented unicode texts</strong>. * param corpus: a list of dataframes * param break_perc: a parameter which dictates whether to include broken words depending on the percentage of how broken they are. Compares this value to the <code>break_perc</code> column in the dataframe. Parameter is set to 1 (i.e.&nbsp;all words, whether broken or not, are included); can be any float between 0 and 1. * param mask: boolean whether to mask named entities or not; set to True. * return: a dictionary where the keys are the text IDs and the values are the segmented unicode texts</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385919838,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:228,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_segmented_unicode_texts(corpus, break_perc<span class="op">=</span><span class="dv">1</span>, mask<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    texts_dict <span class="op">=</span> {}</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> df <span class="kw">in</span> corpus:</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># get the text number from the dataframe "text" column</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> df[<span class="st">"text"</span>].iloc[<span class="dv">0</span>]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        text, text_length_full, text_length_partial <span class="op">=</span> df2str(df, <span class="st">"unicode_word"</span>, break_perc, mask)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        texts_dict[key] <span class="op">=</span> (text, text_length_full, text_length_partial)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> texts_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385921874,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:220,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="5d2b7373-ffe3-495e-c6d8-b54c95131def" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>get_segmented_unicode_texts((split_df_by_column_value(corpus[<span class="dv">0</span>], <span class="st">"text"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>{'Q003414': ('𒉭 𒁄𒌀𒆠 𒋗𒄣𒊒 𒈾𒉘 𒀭X DN 𒀊 𒁀 X X\n𒉿𒄘 DN 𒃻 𒀀𒈾 𒁁𒂁 𒆳𒆳 X 𒀭 𒋾 𒀠 𒋃 X\n𒅕𒁍𒌑 𒀀𒈾 𒈗𒌑𒋾 𒄊𒀴 X X X X X 𒈠\n𒈬𒍦 𒊮𒅆𒃸𒎌 𒀀𒈾 X X X X X X X X 𒋗𒊑𒅔𒉌\n𒍣𒅗𒊒 𒆗𒉡 𒉡𒌨 𒆧𒆳 𒌦𒎌𒋗 𒂊𒌀 X 𒆗 𒂷𒆠 X X 𒋾\n𒁕𒄿𒁍 𒂵𒊑𒂊𒋗 𒄨 𒃼𒁺 𒊓𒉿𒉡 X 𒈾𒆠𒊑 𒃻 𒄯𒊓𒀀𒉌\n𒀉𒄖𒊒𒋾 𒆠𒈠 𒆠𒂊 𒌑𒊩𒇷𒌅𒈠 𒌑X 𒌑 X X X X\n',
  75,
  50)}</code></pre>
</div>
</div>
</section>
<section id="to-create-the-vector-space-model" class="level3">
<h3 class="anchored" data-anchor-id="to-create-the-vector-space-model">To create the vector space model</h3>
<section id="vectorizing-texts" class="level4">
<h4 class="anchored" data-anchor-id="vectorizing-texts">vectorizing texts</h4>
<p><strong>Converts a list of texts into a term-document matrix based on TF-IDF scores</strong>.</p>
<p>Full documentation of the variables of TfidfVectorizer from sklearn, see: https://scikit-learn.org/stable/modules/generated/sklearn.feature_extraction.text.TfidfVectorizer.html#sklearn.feature_extraction.text.TfidfVectorizer * param corpus: a dataframe in which the texts are in a <code>"text"</code> column and the dataframe’s index is the text ids. * param analyzer: whether the feature should be made of word or character n-grams. use <code>"word"</code> for word features, <code>"char_wb"</code> for character n-grams within word boundaries, or <code>"char"</code> for character n-grams without word boundaries. * param ngram_range: the lower and upper boundary of the range of n-values for different n-grams to be extracted. * param max_df: threshold to ignore terms that have a document frequency above a certain value. If the threshold is a float, it represent a proportion of the documents. If the threshold is an integer, it represents absolute counts of number of documents in which the terms appears. * param min_df: threshold to ignore terms that have a document frequency below a certain value. If the threshold is a float, it represent a proportion of the documents. If the threshold is an integer, it represents absolute counts of number of documents in which the terms appears. * param max_features: if not <code>None</code>, build a vocabulary that only considers the top max_features ordered by term frequency across the corpus. * param stop_words: if <code>None</code>, no stop words are used. Otherwise, can be a list with words to be removed from resulting tokens. * return: <code>counts</code> the raw counts of the vectorizer, <code>counts_df</code> a dataframe of the counts where the index is the text ids and the columns are the tokens, <code>stop_words</code> an updated list of stop words</p>
<p><img src="https://www.humanitiesdataanalysis.org/_images/bow.png" class="img-fluid"></p>
<p><strong>Figure 1</strong>. Example of a document-term matrix extracted from a corpus, see Fig. 3 in Karsdorp, F., Kestemont, M., &amp; Riddell, A. (2021). Humanities Data Analysis: Case Studies with Python. Princeton University Press.</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385929859,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:212,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vectorize(corpus, analyzer<span class="op">=</span><span class="st">"word"</span>, ngram_range<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>), max_df<span class="op">=</span><span class="fl">1.0</span>, min_df<span class="op">=</span><span class="dv">1</span>, max_features<span class="op">=</span><span class="va">None</span>, stop_words<span class="op">=</span>[<span class="st">"UNK"</span>, <span class="st">"X"</span>]):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    vectorizer <span class="op">=</span> TfidfVectorizer(<span class="bu">input</span><span class="op">=</span><span class="st">"content"</span>, lowercase<span class="op">=</span><span class="va">False</span>, analyzer<span class="op">=</span>analyzer,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># RegEx for Akkadian</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="co">#token_pattern=r"(?u)\b\w+\b", ngram_range=ngram_range,</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># RegEx for Egyptian</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>                                 token_pattern<span class="op">=</span><span class="vs">r"(?u)\b[\w\.]+\b"</span>, ngram_range<span class="op">=</span>ngram_range,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                                 max_df<span class="op">=</span>max_df, min_df<span class="op">=</span>min_df, max_features<span class="op">=</span>max_features, stop_words<span class="op">=</span>stop_words)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> vectorizer.fit_transform(corpus[<span class="st">"text"</span>].tolist()).toarray()</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    stop_words <span class="op">=</span> vectorizer.stop_words_</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># saving the vocab used for vectorization, and switching the dictionary so that the feature index is the key</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    vocab <span class="op">=</span> vectorizer.vocabulary_</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    switched_vocab <span class="op">=</span> {value: key <span class="cf">for</span> key, value <span class="kw">in</span> vocab.items()}</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adding the vocab words to the counts dataframe for easier viewing.</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    column_names <span class="op">=</span> []</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> x <span class="op">&lt;</span> <span class="bu">len</span>(switched_vocab):</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        column_names.append(switched_vocab[x])</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    counts_df <span class="op">=</span> pd.DataFrame(counts, index<span class="op">=</span>corpus.index, columns<span class="op">=</span>column_names)</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (counts, counts_df, stop_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculating-distances-between-vectorized-documents" class="level4">
<h4 class="anchored" data-anchor-id="calculating-distances-between-vectorized-documents">calculating distances between vectorized documents</h4>
<p><strong>Converts a term-document matrix to a text similarity matrix</strong>. * param counts: the raw counts from the <code>vectorize</code> function. * param metric: the metric by which to calculate the distances between the texts in the corpus. For one place to look into the different types of matrics see “Computing distances between documents” in <a href="https://www.humanitiesdataanalysis.org/vector-space-model/notebook.html#computing-distances-between-documents">Karsdrop, Kestemont, &amp; Riddell 2021</a> Valid metrics are: ‘braycurtis’, ‘canberra’, ‘chebyshev’, ‘cityblock’, ‘correlation’, ‘cosine’, ‘dice’, ‘euclidean’, ‘hamming’, ‘jaccard’, ‘jensenshannon’, ‘kulczynski1’, ‘mahalanobis’, ‘matching’, ‘minkowski’, ‘rogerstanimoto’, ‘russellrao’, ‘seuclidean’, ‘sokalmichener’, ‘sokalsneath’, ‘sqeuclidean’, ‘yule’. * param text_ids: list of unique text_ids. * return: a dataframe matrix of distance between texts.</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385934962,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:202,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> distance_calculator(counts, metric, text_ids):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(squareform(pdist(counts, metric<span class="op">=</span>metric)), index<span class="op">=</span>text_ids, columns<span class="op">=</span>text_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reducing-dimensions-with-pca-or-tsne" class="level4">
<h4 class="anchored" data-anchor-id="reducing-dimensions-with-pca-or-tsne">reducing dimensions with pca or tsne</h4>
<p><strong>Reduces multidimensional data into two dimensions using PCA</strong>. * param df: dataframe holding the dimensions to reduce. All columns should include numerical values only. The dataframe’s index should hold the unique text ids. * param metadata: the rest of the metadata in the corpus, to help visualize the resulting clusters in meaningful ways. The metadata’s index should hold the unique text ids. * return: a dataframe with the coordinates of the two remaining dimensions on all other columns from the metadata.</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385939211,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:211,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reduce_dimensions_pca(df, metadata):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    reduced_data <span class="op">=</span> pca.fit_transform(df)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    reduced_df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>reduced_data, index<span class="op">=</span>df.index, columns<span class="op">=</span>[<span class="st">"component 1"</span>, <span class="st">"component 2"</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    reduced_df_metadata <span class="op">=</span> metadata.join(reduced_df)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> reduced_df_metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Reduces multidimensional data into two dimensions using TSNE</strong>.</p>
<p>See full documentation of sklearn’s TSNE on: https://scikit-learn.org/stable/modules/generated/sklearn.manifold.TSNE.html * param df: dataframe holding the dimensions to reduce. All columns should include numerical values only. The dataframe’s index should hold the unique text ids. * param perplexity: perplexity is a measure the weighs the importance of nearby versus distant points when creating a lower-dimension mapping. t-SNE first converts the distances between points into conditional probabilities that represent similarities, using Gaussian probability distributions. The perplexity parameter influences the variance used to compute these probabilities. A higher perplexity leads to a broader Gaussian that considers a larger number of neighbors when assessing similarity. Lower perplexity puts more focus on the local structure and considers fewer neighbors. A good perplexity depends greatly on dataset size and density. The documentation recommends a value between 5 and 50. We recommend to start with the square root of the length of the corpus. * param n_iter: maximum number of iterations for optimization. * param metric: the metric to be used when calculating distances between vectors. Valid metrics are: ‘braycurtis’, ‘canberra’, ‘chebyshev’, ‘cityblock’, ‘correlation’, ‘cosine’, ‘dice’, ‘euclidean’, ‘hamming’, ‘jaccard’, ‘jensenshannon’, ‘kulczynski1’, ‘mahalanobis’, ‘matching’, ‘minkowski’, ‘rogerstanimoto’, ‘russellrao’, ‘seuclidean’, ‘sokalmichener’, ‘sokalsneath’, ‘sqeuclidean’, ‘yule’. * param metadata: the rest of the metadata in the corpus, to help visualize the resulting clusters in meaningful ways. The metadata’s index should hold the unique text ids. * return: a dataframe with the coordinates of the two remaining dimensions on all other columns from the metadata.</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385945393,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:223,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reduce_dimensions_tsne(df, perplexity, n_iter, metric, metadata):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    tsne <span class="op">=</span> TSNE(n_components<span class="op">=</span><span class="dv">2</span>, perplexity<span class="op">=</span>perplexity, n_iter<span class="op">=</span>n_iter, metric<span class="op">=</span>metric, init<span class="op">=</span><span class="st">"pca"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    reduced_data <span class="op">=</span> tsne.fit_transform(df)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    reduced_df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>reduced_data, index<span class="op">=</span>df.index, columns<span class="op">=</span>[<span class="st">"component 1"</span>, <span class="st">"component 2"</span>])</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    reduced_df_metadata <span class="op">=</span> metadata.join(reduced_df)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> reduced_df_metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="process-texts-from-dataframes-and-combine-results-with-metadata-dataframe" class="level2">
<h2 class="anchored" data-anchor-id="process-texts-from-dataframes-and-combine-results-with-metadata-dataframe">Process texts from dataframes and combine results with metadata dataframe</h2>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737385949628,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:226,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to combine processed texts with metadata</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_corpus_metadata(texts_dict, metadata):</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  texts_df <span class="op">=</span> pd.DataFrame(texts_dict, index<span class="op">=</span>[<span class="st">"text"</span>, <span class="st">"full_length"</span>, <span class="st">"partial_length"</span>]).transpose()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  df <span class="op">=</span> metadata.join(texts_df)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737386213592,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:16204,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="e173e0a1-a2df-483e-ce09-4309814181d2" data-execution_count="32">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">## vectorize lemma forms</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>corpus_dict <span class="op">=</span> get_lemmatized_texts(corpus, break_perc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">## vectorize normalized forms</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>corpus_dict <span class="op">=</span> get_normalized_texts(corpus, break_perc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">## vectorize Unicode cuneiform</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>corpus_dict <span class="op">=</span> get_segmented_unicode_texts(corpus, break_perc<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>corpus_metadata <span class="op">=</span> get_corpus_metadata(corpus_dict, metadata)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">## For Akkadian</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">## remove texts which have less than n words excluding UNK and X</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of texts before filtering: </span><span class="sc">{</span>corpus_metadata<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>corpus_metadata <span class="op">=</span> corpus_metadata[corpus_metadata[<span class="st">"partial_length"</span>]<span class="op">&gt;=</span>n]</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of texts after filtering: </span><span class="sc">{</span>corpus_metadata<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># For Egyptian use this instead, reset the index</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># n = 150</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Number of texts before filtering: {corpus_metadata.shape[0]}")</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># corpus_metadata = corpus_metadata[corpus_metadata["partial_length"]&gt;=n].set_index("text_name")</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f"Number of texts after filtering: {corpus_metadata.shape[0]}")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of texts before filtering: 432
Number of texts after filtering: 308</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1737386217542,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:271,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="387010bf-f587-421c-8d39-272c51ccc8a7" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>corpus_metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">


  <div id="df-9bf59613-3ceb-44c2-8322-b4ae631f40e2" class="colab-df-container">
    <div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>langs</th>
      <th>project</th>
      <th>cdli_id</th>
      <th>collection</th>
      <th>credits</th>
      <th>date_of_origin</th>
      <th>designation</th>
      <th>display_name</th>
      <th>dynastic_seat</th>
      <th>exemplars</th>
      <th>...</th>
      <th>script_type</th>
      <th>subgenre</th>
      <th>supergenre</th>
      <th>trans</th>
      <th>id_text</th>
      <th>seal_id</th>
      <th>attribution</th>
      <th>text</th>
      <th>full_length</th>
      <th>partial_length</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Q003414</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463047</td>
      <td>Archäologisches Institut der Universität Züric...</td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 01</td>
      <td>RINAP 1 Tigl. III 01</td>
      <td>Assyria</td>
      <td>ZhArchSlg 1917 (+) ZhArchSlg 1918 (+) NA 12/76</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
      <td>𒉭 𒁄𒌀𒆠 X 𒈾𒉘 X X 𒀊 𒁀 X X\n𒉿𒄘 X 𒃻 𒀀𒈾 𒁁𒂁 X X 𒀭 𒋾 𒀠...</td>
      <td>75</td>
      <td>35</td>
    </tr>
    <tr>
      <th>Q003417</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463048</td>
      <td></td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 04</td>
      <td>RINAP 1 Tigl. III 04</td>
      <td>Assyria</td>
      <td>NA 09/76</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
      <td>𒄿𒈾 𒊕 𒈗𒋾𒅀 𒄿𒈾 𒈤𒊑𒂊 𒁄𒅀 𒄿𒈾 n X\n𒊭 𒄿𒈾 𒄑𒄖𒍝 𒈗𒌑𒋾 𒊏𒄫 𒌑𒅆𒁍...</td>
      <td>37</td>
      <td>36</td>
    </tr>
    <tr>
      <th>Q003418</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463049</td>
      <td>British Museum, London, UK</td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 05</td>
      <td>RINAP 1 Tigl. III 05</td>
      <td>Assyria</td>
      <td>BM 118934 (Layard, MS A pp. 113-114)</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
      <td>X X 𒀀𒈾 𒆳𒋗𒉡 𒅋𒇷𒆪 𒌷𒎌 X X 𒌍𒋗𒋾 𒆕𒍑 𒄿𒈾 𒌋𒅗 𒇯 𒄰𒊑\nX X X...</td>
      <td>184</td>
      <td>98</td>
    </tr>
    <tr>
      <th>Q003419</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463049</td>
      <td>British Museum, London, UK</td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 06</td>
      <td>RINAP 1 Tigl. III 06</td>
      <td>Assyria</td>
      <td>BM 118934 (Layard, MS A p. 114)</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
      <td>𒀀𒈾 𒌍𒋗𒋼 𒀝𒋓𒈠 𒆳 GN 𒀀𒈾 X\n𒌷 𒆕𒍑 𒂍𒃲 𒈬𒉺𒅁 X X X X X\n𒈬...</td>
      <td>111</td>
      <td>54</td>
    </tr>
    <tr>
      <th>Q003420</th>
      <td>0x08000000</td>
      <td>rinap/rinap1</td>
      <td>P463050</td>
      <td>British Museum, London, UK</td>
      <td>Created by Hayim Tadmor, Shigeo Yamada, Jamie ...</td>
      <td>744-727</td>
      <td>Tiglath-pileser III 07</td>
      <td>RINAP 1 Tigl. III 07</td>
      <td>Assyria</td>
      <td>BM 118933 (Layard, MS A pp. 111-112)</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Tiglath-pileser III</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td></td>
      <td>X X SN SN SN SN SN\nX 𒆳𒂊 𒊭 GN 𒋗𒋛 𒆳𒂊 𒃻𒆥𒌅 𒄑𒁀𒌅 𒅈𒆠...</td>
      <td>141</td>
      <td>115</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Q009293</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td>British Museum, London, UK</td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>668-ca. 631</td>
      <td>Ashurbanipal 1025</td>
      <td>RINAP 5 Asb. 1025</td>
      <td>Assyria</td>
      <td>K 04498</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Ashurbanipal</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>X X 𒋗𒈨𒋙 𒆏𒋼 X\nX X 𒋳𒉌𒂊 𒈬𒅆 𒃻 X X\nX X X X X X\nX...</td>
      <td>38</td>
      <td>10</td>
    </tr>
    <tr>
      <th>Q009294</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td>British Museum, London, UK</td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>668-ca. 631</td>
      <td>Ashurbanipal 1026</td>
      <td>RINAP 5 Asb. 1026</td>
      <td>Assyria</td>
      <td>K 08361</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Ashurbanipal</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>X X X X X X X\nX X\nX X 𒋾𒆷 X X X X\nX X 𒆠𒆗𒋙 𒌑𒃻...</td>
      <td>84</td>
      <td>22</td>
    </tr>
    <tr>
      <th>Q009295</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td>British Museum, London, UK</td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>668-ca. 631</td>
      <td>Ashurbanipal 1027</td>
      <td>RINAP 5 Asb. 1027</td>
      <td>Assyria</td>
      <td>K 06681</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Ashurbanipal</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>X X X X X X X\nX X 𒆠𒂊𒉡 𒂊𒌓 X X\n𒂷𒆪 𒇷𒀪𒌋 𒀀𒄭𒄑 𒉌𒈨𒅅 ...</td>
      <td>80</td>
      <td>39</td>
    </tr>
    <tr>
      <th>Q009297</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td>British Museum, London, UK</td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>668-ca. 631</td>
      <td>Ashurbanipal 1029</td>
      <td>RINAP 5 Asb. 1029</td>
      <td>Assyria</td>
      <td>Bu 1891-05-09, 0204</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Ashurbanipal</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>X X X X X X X X X X X X X\nX X X X X X X X X X...</td>
      <td>204</td>
      <td>23</td>
    </tr>
    <tr>
      <th>Q009298</th>
      <td>0x08000000</td>
      <td>rinap/rinap5</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>668-ca. 631</td>
      <td>Ashurbanipal 1030</td>
      <td>RINAP 5 Asb. 1030</td>
      <td>Assyria</td>
      <td>Shikaft-i Gulgul rock relief</td>
      <td>...</td>
      <td>Cuneiform</td>
      <td>Ashurbanipal</td>
      <td>LIT</td>
      <td>['en']</td>
      <td></td>
      <td></td>
      <td>Created by Jamie Novotny and Joshua Jeffers, 2...</td>
      <td>DN 𒅇 X X\nX 𒄿𒁲 𒈗 X X\nX X X\nX X 𒋙 X X X X X X...</td>
      <td>183</td>
      <td>85</td>
    </tr>
  </tbody>
</table>
<p>308 rows × 34 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-9bf59613-3ceb-44c2-8322-b4ae631f40e2')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-9bf59613-3ceb-44c2-8322-b4ae631f40e2 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-9bf59613-3ceb-44c2-8322-b4ae631f40e2');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-cb8a0de6-c362-4109-a60f-04ebef5adc26">
  <button class="colab-df-quickchart" onclick="quickchart('df-cb8a0de6-c362-4109-a60f-04ebef5adc26')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-cb8a0de6-c362-4109-a60f-04ebef5adc26 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_dc4a1690-67e5-40cb-b736-1a73caab5a0b">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('corpus_metadata')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_dc4a1690-67e5-40cb-b736-1a73caab5a0b button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('corpus_metadata');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div>
</section>
</section>
<section id="exploring-the-akkadian-rinap-or-egyptian-tla-corpus-using-the-vector-space-model" class="level1">
<h1>Exploring the Akkadian RINAP or Egyptian TLA Corpus using the Vector Space Model</h1>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;error&quot;,&quot;timestamp&quot;:1737386223244,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:231,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="785fe316-cf01-43a7-ad3d-d5867f82b6eb" data-execution_count="34">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vectorize corpus</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>counts, counts_df, stop_words <span class="op">=</span> vectorize(corpus_metadata, max_features<span class="op">=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'TfidfVectorizer' object has no attribute 'stop_words_'</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;error&quot;,&quot;timestamp&quot;:1737386258681,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:264,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}" data-outputid="cef15bc2-86e2-4308-f645-1749a32dcf0d" data-execution_count="35">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>counts_df.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'counts_df' is not defined</code></pre>
</div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;aborted&quot;,&quot;timestamp&quot;:1737385521418,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:13266,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate distance between vectorized texts</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>matrix <span class="op">=</span> distance_calculator(counts, <span class="st">"cosine"</span>, corpus_metadata.index)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;aborted&quot;,&quot;timestamp&quot;:1737385521418,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:13265,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize matrix</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.imshow(matrix)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust size of the matrix</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    autosize<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="dv">1500</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">1500</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;aborted&quot;,&quot;timestamp&quot;:1737385521418,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:13264,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce matrix dimensions</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>reduced_tsne <span class="op">=</span> reduce_dimensions_tsne(matrix, perplexity<span class="op">=</span>matrix.shape[<span class="dv">0</span>]<span class="op">**</span><span class="fl">0.5</span>, n_iter<span class="op">=</span><span class="dv">5000</span>, metric<span class="op">=</span><span class="st">"euclidean"</span>, metadata<span class="op">=</span>corpus_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;aborted&quot;,&quot;timestamp&quot;:1737385521418,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:13262,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize reduced dimensions</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust size column for visualization</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>size_min <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>size_max <span class="op">=</span> <span class="dv">70</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>size <span class="op">=</span> (reduced_tsne[<span class="st">"partial_length"</span>] <span class="op">/</span> reduced_tsne[<span class="st">"partial_length"</span>].<span class="bu">max</span>() <span class="op">*</span> (size_max <span class="op">-</span> size_min) <span class="op">+</span> size_min).tolist()</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create figure</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># for Akkadian use symbol = "script", color="project",</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># for Egyptian</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(reduced_tsne, x<span class="op">=</span><span class="st">"component 1"</span>, y<span class="op">=</span><span class="st">"component 2"</span>, size<span class="op">=</span>size, symbol <span class="op">=</span> <span class="st">"corpus_manual"</span>, color<span class="op">=</span><span class="st">"language_manual"</span>, hover_data<span class="op">=</span>[<span class="st">"partial_length"</span>, <span class="st">"full_length"</span>, reduced_tsne.index])</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>fig.update_traces(marker<span class="op">=</span><span class="bu">dict</span>(line<span class="op">=</span><span class="bu">dict</span>(width<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'black'</span>)))</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="find-shared-tokens" class="level1">
<h1>Find Shared Tokens</h1>
<p><strong>creates a mini df that includes only the chosen text and the shared tokens in those texts</strong> (i.e., all tokens that are none zero in all texts). * param df: the counts_df where the index is the text ids and the columns are the tokens. * param text_ids: a list containing text ids. * return: a dataframe where the index are the shared tokens and the columns are the texts. the values are the tf-idf scores.</p>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;aborted&quot;,&quot;timestamp&quot;:1737385521419,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:13262,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_shared_tokens(df, text_ids):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  mini_df <span class="op">=</span> df[df.index.isin(text_ids)].copy()</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  mini_df <span class="op">=</span> mini_df.loc[:, (mini_df <span class="op">!=</span> <span class="dv">0</span>).<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">0</span>)].copy()</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> mini_df.transpose()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;aborted&quot;,&quot;timestamp&quot;:1737385521419,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:13261,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Akkadian</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>shared_tokens <span class="op">=</span> find_shared_tokens(counts_df, [<span class="st">"Q003450"</span>, <span class="st">"Q003711"</span>, <span class="st">"Q003790"</span>])</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Egyptian</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#shared_tokens = find_shared_tokens(counts_df, ["pEdwinSmith_Wundenbuch_1-27", "pEdwinSmith_Wundenbuch_28-48", "pEdwinSmith_Hautverschoenerung", "pEbers_432-436"])#, "3RU7Z4VQ45CYFIQ4PUGQ3HDJFU"])</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>shared_tokens</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executioninfo="{&quot;status&quot;:&quot;aborted&quot;,&quot;timestamp&quot;:1737385521419,&quot;user_tz&quot;:-120,&quot;elapsed&quot;:13260,&quot;user&quot;:{&quot;displayName&quot;:&quot;shai gordin&quot;,&quot;userId&quot;:&quot;12645290687300756012&quot;}}">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>px.scatter(shared_tokens)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>This notebook was created by <a href="https://github.com/ARomach">Avital Romach</a>, with additional code and text by <a href="https://www.geschkult.fu-berlin.de/e/aegyptologie/personen/Professorinnen-und-Professoren/Lincke/index.html">Eliese-Sophia Lincke</a>, <a href="https://digitalpasts.github.io/">Shai Gordin</a> and <a href="https://www.bbaw.de/die-akademie/mitarbeiterinnen-mitarbeiter/werning-daniel">Daniel A. Werning</a> in Spring 2024 for the course <a href="https://digitalpasts.github.io/ALP-course/">Ancient Language Processing</a>. Code can be reused under a <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY 4.0</a></em></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/DigitalPasts">
      <i class="bi bi-github" role="img" aria-label="DigPasts GitHub">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/shgordin">
      <i class="bi bi-twitter" role="img" aria-label="Shai Gordin Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:digpasts@gmail.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>   
      <div class="nav-footer-center">© Digital Pasts Lab, 2025</div>
  </div>
</footer>



</body></html>